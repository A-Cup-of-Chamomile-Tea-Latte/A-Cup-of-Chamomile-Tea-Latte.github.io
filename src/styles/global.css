:root {
  /* === 1. 核心顏色系統 (保留原本設定) === */
  --red-0: #ff0000;
  --red-1: #ff5252;
  --red-2: #ff7c7c;
  --red-3: #ffafaf;
  --red-4: #ffd0d0;
  --red-5: #ffecec;
  --red-5-5: #fff3f3;
  --red-6: #fff7f7;
  --color-red-6-shadow: rgba(255, 78, 78, 0.6);
  --color-red-3-shadow: rgba(255, 78, 78, 0.3);
  --grey-9: #888;
  --grey-7: var(--color-default);

  --color-archive-year: black;
  --color-default: #444;
  --color-border: var(--red-3);
  --color-link: var(--red-1);
  --color-background: #eee;
  --color-code-background: #f8f8f8;
  --color-header-background: rgba(255, 255, 255, 0.9);
  --color-footer-background: #fff;
  --color-mobile-nav-background: #fff;
  --color-wrap: #fff;

  --color-h2-border: #eee;
  --color-meta-shadow: var(--red-6);
  --color-hover-shadow: rgba(120, 120, 120, 0.15);
  --color-h2-after: var(--red-1);

  --shadow-meta: 0 0 5px 2px var(--color-meta-shadow);
  --shadow-meta-hover: 0 0 6px 4px var(--color-meta-shadow);
  --shadow-card: 0 0 10px 2px var(--color-hover-shadow);
  --shadow-card-hover: 0 0 10px 4px var(--color-hover-shadow);
  --shadow-red-6-shadow: 0 0 8px var(--color-red-6-shadow);

  /* === 2. 數位門面：字體定義 (2026 Updated) === */
  /* 系統與正文：Inter (英) + Noto Sans TC (中) -> 確保清晰度 */
  --font-sans: "Inter", "Noto Sans TC", "Microsoft JhengHei", system-ui, sans-serif;
  /* 標題與強調：Lora (英) + Noto Sans TC (中) -> 增加學術氣質 */
  --font-serif: "Lora", "Noto Sans TC", "Times New Roman", serif;
}

[data-theme="dark"]:root {
  --red-0: var(--red-1);
  --red-4: rgba(255, 208, 208, .5);
  --red-5: rgba(255, 228, 228, .15);
  --red-5-5: rgba(255, 236, 236, .05);
  --red-6: rgba(255, 243, 243, .2);

  --color-archive-year: #999;
  --color-default: #999;
  --color-border: var(--red-5);
  --color-background: #21252b;
  --color-code-background: rgba(232, 232, 232, 0.2);
  --color-header-background: #222222;
  --color-footer-background: #21252b;
  --color-mobile-nav-background: #21252b;
  --color-wrap: #272b30;

  --color-h2-border: #47474a;
  --color-meta-shadow: rgba(0, 0, 0, 0.2);
  --color-hover-shadow: rgba(0, 0, 0, 0.2);

  img {
    filter: brightness(70%);
  }
}

/* fix astro bug */
svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}
.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}

/* === 3. 基礎 Reset 與全站設定 === */
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
dl, dt, dd, ol, ul, li, fieldset, form,
label, legend, table, caption, tbody, tfoot,
thead, tr, th, td {
  font-weight: inherit;
  font-style: inherit;
  vertical-align: baseline;
  border: 0;
  outline: 0;
  margin: 0;
  padding: 0;
  font-family: inherit; /* 繼承 body 設定 */
  font-size: 100%;
}

ol, ul { list-style: none; }
table { border-collapse: separate; border-spacing: 0; vertical-align: middle; }
caption, th, td { text-align: left; vertical-align: middle; font-weight: 400; }
a img { border: none; }
input, button { margin: 0; padding: 0; }
input::-moz-focus-inner, button::-moz-focus-inner { border: 0; padding: 0; }

/* 標題預設使用 Serif (Lora) */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  font-family: var(--font-serif); 
}

body {
  width: 100%;
  background: var(--color-background);
  -webkit-text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  text-size-adjust: 100%;
  transition: background 1s, 0.3s;
  text-autospace: normal;
  color: var(--color-default);
  
  /* === 核心字體套用 === */
  font-family: var(--font-sans); /* 預設使用 Inter/Noto Sans */
  line-height: 1.6; /* 全站基礎行高優化 */
}

::selection {
  background: var(--red-1);
  color: #fff;
}

#mask {
  z-index: 1000;
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px);
  opacity: 1;
  transition: 0.3s;
  &.hide { opacity: 0; visibility: hidden; }
}

.mobile-nav-on { overflow: hidden !important; }

#main {
  flex: 1;
  padding: 0 20px;
  max-width: 100%;
  box-sizing: border-box;
  @media screen and (max-width: 959px) { min-width: 100%; }
  @media screen and (max-width: 767px) { padding: 0 16px; }
}

[data-theme="dark"] ::-webkit-scrollbar,
[data-theme="dark"] ::-webkit-scrollbar-track { background-color: #616161; }
::-webkit-scrollbar { width: 10px; height: 10px; background-color: #f5f5f5; }
::-webkit-scrollbar-track { border-radius: 10px; background-color: #f5f5f5; }
::-webkit-scrollbar-thumb { border-radius: 10px; background-color: var(--red-3); }
[data-aos^="fade"], [data-aos^="zoom"] { transition-property: all !important; }


/* ================================================= */
/* === 4. 數位門面：學術風格優化包 (Graduate Style) === */
/* ================================================= */

/* --- 4.1 文章內容專屬字體 (只影響文章，不影響側邊欄) --- */
.article-entry {
  font-family: var(--font-sans);
  font-size: 1.1rem; /* 字體微調大，閱讀舒適 */
  line-height: 1.8;  /* 寬鬆行高 */
}

/* 文章標題使用襯線體 (Lora) 增加學術感 */
.article-entry h1, 
.article-entry h2, 
.article-entry h3, 
.article-entry h4 {
  font-family: var(--font-serif);
  margin-top: 2em;
  margin-bottom: 1em;
  color: #1a1a1a;
}
[data-theme="dark"] .article-entry h1,
[data-theme="dark"] .article-entry h2 { color: #e0e0e0; }


/* --- 4.2 智慧縮排：模仿 LaTeX 論文行為 --- */
.article-entry p {
  text-align: justify; /* 左右對齊 */
  margin-bottom: 1.2em;
}
/* 只有「段落後的段落」才縮排 (標題後首段不縮) */
.article-entry p + p {
  text-indent: 2em;
  margin-top: -0.8em; /* 讓縮排的段落之間稍微緊湊一點 */
}
/* 避免特殊 class 縮排 (如無縮排段落) */
.article-entry .no-indent {
  text-indent: 0 !important;
}
/* 確保 KaTeX 區塊數學公式不被縮排影響 */
.article-entry .katex-display {
  text-indent: 0;
  margin: 1.5em 0;
  overflow-x: auto; /* 避免手機版超出 */
  overflow-y: hidden;
}


/* --- 4.3 表格系統：雙模式支援 --- */

/* (模式A) 預設 Markdown 表格：保留格線 */
.article-entry table {
  border-collapse: collapse;
  margin: 2em auto;
  border: 1px solid #ddd;
  width: 100%;
  font-family: var(--font-sans);
  font-size: 0.95em;
}
.article-entry th, .article-entry td {
  border: 1px solid #ddd;
  padding: 8px 12px;
  text-align: center;
}
.article-entry th {
  background-color: #f9f9f9;
  font-weight: 600;
}

/* (模式B) 學術三線表容器 (Booktabs Wrapper) */
/* 讓被 .booktabs-style 包住的表格強制變成論文樣式 */
.booktabs-style table {
  border-collapse: collapse !important;
  border: none !important;
  margin: 1.5em auto !important;
  width: 100%;
}
.booktabs-style th {
  border: none !important;
  border-top: 2px solid #000 !important;    /* 頂線 */
  border-bottom: 1px solid #000 !important; /* 中線 */
  padding: 10px 8px !important;
  text-align: center !important;
  font-weight: 700 !important;
  background: transparent !important;
}
.booktabs-style td {
  border: none !important;
  border-bottom: 1px solid #eee !important; /* 淡淡的行線 */
  padding: 8px !important;
  text-align: center !important;
}
.booktabs-style tr:last-child td {
  border-bottom: 2px solid #000 !important; /* 底線 */
}
/* 隱藏 Note 小字的邊框 */
.booktabs-style em {
  display: block;
  margin-top: 5px;
  font-size: 0.85em;
  color: #666;
  text-align: left;
}


/* --- 4.4 圖片與說明文字 (Caption) 優化 --- */
/* 讓所有圖片預設圓角 + 陰影 + 置中 */
.article-entry img {
  display: block;
  margin: 1.5em auto;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  max-width: 100%;
}

/* Figure 標籤支援 */
figure {
  display: block;
  text-align: center;
  margin: 2em 0;
}
figure img {
  margin-bottom: 0.5em; /* 圖片跟說明的距離 */
}
figcaption {
  margin-top: 0.5em;
  font-size: 0.9rem;
  color: #666;
  font-family: var(--font-sans);
  font-style: italic;
}


/* --- 4.5 擴充功能：高亮與其他 --- */
/* 讓預設的黃色高亮不那麼刺眼 */
mark {
  background-color: rgba(255, 235, 59, 0.3); 
  padding: 0 4px;
  border-radius: 2px;
  color: inherit;
}