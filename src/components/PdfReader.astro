---
export interface Props {
  url: string;
  title?: string;
  height?: string;
}

/**
 * PdfReader 組件
 * 用法：<PdfReader url="你的PDF直連連結" title="論文標題" height="600px" />
 */

const { url, title = "PDF Document", height = "750px" } = Astro.props;

// 簡單處理 Google Drive 連結轉直連的邏輯 (如果是 ID 格式)
let finalUrl = url;
if (url.includes("drive.google.com/file/d/")) {
  const fileId = url.split("/d/")[1].split("/")[0];
  finalUrl = `https://drive.google.com/uc?id=${fileId}`;
}
---

<div class="pdf-container" data-aos="fade-up">
  {title && <div class="pdf-header">
    <i class="fa-solid fa-file-pdf"></i>
    <span>{title}</span>
  </div>}
  
  <div class="pdf-wrapper">
    <object
      data={finalUrl}
      type="application/pdf"
      width="100%"
      height={height}
    >
      <div class="pdf-fallback">
        <p>您的瀏覽器不支援直接預覽 PDF。</p>
        <a href={finalUrl} target="_blank" class="download-btn">
          <i class="fa-solid fa-download"></i> 下載檔案觀看
        </a>
      </div>
    </object>
  </div>
</div>

<style>
  .pdf-container {
    margin: 2rem 0;
    border: 1px solid var(--color-border);
    border-radius: 12px;
    overflow: hidden;
    background: var(--color-wrap);
    box-shadow: var(--shadow-meta);
  }

  .pdf-header {
    padding: 12px 20px;
    background: var(--red-5);
    color: var(--red-1);
    font-size: 0.9rem;
    font-weight: bold;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .pdf-wrapper {
    line-height: 0;
    background: #525659; /* 模擬 PDF 閱讀器背景色 */
  }

  .pdf-fallback {
    padding: 40px;
    text-align: center;
    color: white;
  }

  .download-btn {
    display: inline-block;
    margin-top: 15px;
    padding: 8px 20px;
    background: var(--red-1);
    color: white !important;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.85rem;
  }

  /* 針對手機端的優化 */
  @media (max-width: 768px) {
    .pdf-wrapper object {
      height: 500px;
    }
  }
</style>